<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AEM Components</title>
    <!-- Materialize CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.2/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.3.3/css/buttons.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.2/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.3/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.3/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.3/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.3/js/buttons.colVis.min.js"></script>
    <link rel="stylesheet" href="/styles/style.css">
    <style>
        .table-container {
            display: block;
        }
        
        .table-wrapper {
            margin: 0;
            padding: 0;
        }
        
        .container {
            margin-top: 30px;
        }
        
        .input-field {
            margin-bottom: 20px;
        }
        
        select {
            display: block;
        }
    </style>
</head>

<body>
    <div style="margin: 10px;">
        <h4 class="center-align">AEM Component Analysis for
            <%= location %>
        </h4>

        <!-- Dropdown to select table type -->
        <div class="input-field col s12">
            <label for="tableTypeDropdown">Select Table Type</label>
            <select id="tableTypeDropdown">
                <option value="resultTable" selected>Result Table</option>
                <option value="usageCount">Usage Count</option>
            </select>
            <label for="pageLengthDropdown">Select Page Length</label>
            <select id="pageLengthDropdown">
                <option value="10">10</option>
                <option value="25">25</option>
                <option value="50" selected>50</option>
                <option value="100">100</option>
                <option value="200">200</option>
                <option value="500">500</option>
            </select>
        </div>

        <div id="datatables" style="overflow-y: scroll;">
            <!-- Div for Result Table -->
            <div id="resultTableContainer" class="table-container table-wrapper">
                <table id="resultTable" class="highlight responsive-table">
                    <thead>
                        <tr>
                            <th>File Path</th>
                            <% headers.forEach(header => { %>
                                <th>
                                    <%= header %>
                                </th>
                                <% }); %>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Rows will be dynamically added here -->
                    </tbody>
                </table>
            </div>

            <!-- Div for Usage Count Table -->
            <div id="usageCountContainer" class="table-container table-wrapper">
                <!-- Dropdown to select header for Usage Count table -->
                <div class="input-field col s12">
                    <label for="headerDropdown">Select Header</label>
                    <select id="headerDropdown">
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>

                <!-- Table to display usage count data -->
                <table id="usageCountTable" class="highlight responsive-table">
                    <thead>
                        <tr>
                            <th>Unique Value</th>
                            <th>Usage Count</th>
                            <th>File Paths</th>
                            <th>Titles</th>
                            <th>Category</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Rows will be dynamically added here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Inject server-side data into JavaScript variables -->
    <script>
        const data = <%- JSON.stringify(data) %>;
        const headers = <%- JSON.stringify(headers) %>;
    </script>

    <!-- Include external JavaScript file -->
    <script src="/scripts/dataTables.js"></script>
</body>

</html>